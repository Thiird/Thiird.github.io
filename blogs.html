<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SN - Blogs</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      const renderer = new marked.Renderer();
      renderer.link = function (href, title, text) {
        let linkHref = href;
        let linkText = text;
        let linkTitle = title;
        if (typeof href === "object" && href !== null) {
          linkHref = href.href || "";
          linkText = href.text || text || "";
          linkTitle = href.title || title || "";
        }
        linkHref = linkHref.replace(/"/g, "&quot;");
        linkText = linkText || "Link";
        return `<a href="${linkHref}" target="_blank" rel="noopener noreferrer" ${
          linkTitle ? `title="${linkTitle}"` : ""
        }>${linkText}</a>`;
      };
      marked.setOptions({
        renderer: renderer,
        highlight: function (code, lang) {
          const hljs = window.hljs;
          return hljs.highlight(code, { language: lang }).value;
        },
        langPrefix: "hljs language-",
      });
      document.addEventListener("DOMContentLoaded", () => {
        hljs.highlightAll();
      });
    </script>
  </head>
  <body>
    <button id="backToTop" title="Go to top">⬆</button>

    <div id="banner-placeholder"></div>

    <section class="content-scale-wrapper">
      <div class="blog-list" id="blogList">
        <div class="blog-list-header">
          <button id="toggleBlogList" class="toggle-btn">☰</button>
          <input type="text" id="blogSearch" class="blog-search" placeholder="Search blogs..." />
        </div>
        <ul id="blogListItems">
          <!-- dynamically filled -->
        </ul>
      </div>

      <div class="blog-container">
        <div class="blog-content" id="blogContent">
          <div class="blog-text" id="blogText">Loading blog post...</div>
        </div>
      </div>
    </section>

    <script>
      fetch("banner.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("banner-placeholder").innerHTML = data;

          // Ensure dropdowns are initialized after banner loads
          if (typeof initDropdownToggle === "function") {
            initDropdownToggle();
          }

          // Adjust blog list position
          adjustSidebarHeight();
        })
        .catch((error) => console.error("Error loading banner:", error));

      // Adjust sidebar height dynamically
      function adjustSidebarHeight() {
        const banner = document.getElementById("banner-placeholder");
        const blogList = document.getElementById("blogList");
        if (banner && blogList) {
          const bannerBottom = banner.getBoundingClientRect().bottom;
          blogList.style.top = `${Math.max(0, bannerBottom)}px`;
          blogList.style.height = `calc(100vh - ${Math.max(0, bannerBottom)}px)`;
        }
      }

      // Fix toggle functionality for blog list
      document.getElementById("toggleBlogList").addEventListener("click", () => {
        const blogList = document.getElementById("blogList");
        blogList.classList.toggle("collapsed");
      });

      window.addEventListener("resize", adjustSidebarHeight);
      window.addEventListener("scroll", adjustSidebarHeight);
      window.addEventListener("load", adjustSidebarHeight);

      // Search and sort functionality
      document.getElementById("blogSearch").addEventListener("input", (e) => {
        const search = e.target.value.toLowerCase();
        document.querySelectorAll("#blogListItems li").forEach((item) => {
          const title = item.textContent.toLowerCase();
          item.style.display = title.includes(search) ? "block" : "none";
        });
      });
    </script>
    <script src="script.js"></script>
  </body>
</html>