<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SN - Poems</title>
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <script>
        // Set theme immediately to prevent FOUC (Flash of Unstyled Content)
        (function () {
            try {
                const savedTheme = localStorage.getItem("theme") || "light";
                document.documentElement.setAttribute("data-theme", savedTheme);
            } catch (e) {
                // Fallback if localStorage is blocked
                document.documentElement.setAttribute("data-theme", "light");
            }
        })();
    </script>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div id="banner-placeholder"></div>

    <button id="sidebarFloatingToggle" class="mobile-sidebar-toggle" aria-label="Open menu">‚ò∞</button>

    <div class="content-scale-wrapper">
        <div class="poem-list" id="poemList">
            <div class="poem-list-header">
                <button id="toggleSidebar" class="toggle-btn">‚ò∞</button>
                <input type="text" id="poemSearch" placeholder="Search poems..." class="poem-search" />
            </div>
            <div class="sidebar-inner">
                <ul id="poemListItems">
                </ul>
            </div>
        </div>

        <div class="poem-container">
            <!-- Reading Mode Controls -->
            <div class="reading-mode-controls" id="readingModeControls">
                <button class="mode-icon" id="dynamicModeBtn" title="Dynamic Performance Mode">
                    <span>‚úíÔ∏è</span>
                </button>
                <button class="nav-icon" id="dynamicDownBtn" title="Next Paragraph" style="display: none;">
                    <span>‚ñº</span>
                </button>
                <button class="tooltip-toggle-icon" id="tooltipToggleIcon" title="Toggle Tooltips"
                    style="display: none;">
                    <span id="tooltipIconSymbol">üí¨</span>
                </button>
            </div>

            <div class="poem-content" id="poemContent">
                <div class="audio-player" style="display: none" id="audioPlayer">
                    <div class="player-controls">
                        <button id="playPause" class="player-btn">‚ñ∂</button>
                        <span id="currentTime">0:00</span>
                        <div class="progress-container">
                            <div id="progressBar"></div>
                            <div id="progressHandle" class="progress-handle" role="slider" tabindex="0"
                                aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"></div>
                        </div>
                        <span id="duration">0:00</span>
                    </div>
                    <audio id="audioElement">
                        <source src="" type="audio/mpeg" />
                    </audio>
                </div>

                <div class="poem-text" id="poemText">Loading poem...</div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        // Load banner
        fetch("banner.html")
            .then(response => response.text())
            .then(html => {
                document.getElementById("banner-placeholder").innerHTML = html;
                if (typeof initDropdownToggle === "function") {
                    initDropdownToggle();
                }
            })
            .catch(error => console.error("Failed to load banner:", error));

        // Initialize poem page
        document.addEventListener("DOMContentLoaded", () => {
            if (typeof initPoemPage === "function") {
                initPoemPage();
            }
            // Initialize reading mode manager
            if (typeof initReadingModeManager === "function") {
                initReadingModeManager();
            }
        });
    </script>
</body>

</html>