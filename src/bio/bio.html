<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SN - Bio</title>
    <link rel="stylesheet" href="../styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Highlight.js Dark Theme -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />

    <!-- Highlight.js core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      // Configure marked to open links in a new tab
      const renderer = new marked.Renderer();
      renderer.link = function (href, title, text) {

        // Handle case where href might be an object (older marked versions)
        let linkHref = href;
        let linkText = text;
        let linkTitle = title;

        if (typeof href === 'object' && href !== null) {
          // Older marked versions pass a token object
          linkHref = href.href || '';
          linkText = href.text || text || '';
          linkTitle = href.title || title || '';
        }

        // Sanitize href to prevent XSS (basic escaping)
        linkHref = linkHref.replace(/"/g, '&quot;');
        linkText = linkText || 'Link'; // Fallback if text is undefined

        return `<a href="${linkHref}" target="_blank" rel="noopener noreferrer" ${linkTitle ? `title="${linkTitle}"` : ''}>${linkText}</a>`;
      };

      marked.setOptions({
        renderer: renderer,
        highlight: function (code, lang) {
          const hljs = window.hljs;
          return hljs.highlight(code, { language: lang }).value;
        },
        langPrefix: 'hljs language-',
      });

      document.addEventListener("DOMContentLoaded", () => {
        hljs.highlightAll();
      });
    </script>
  </head>
  <body>
    <!-- Back to Top Button -->
    <button id="backToTop" title="Go to top">â¬†</button>

    <div id="banner-placeholder"></div>

    <section class="content-container">
      <div class="content-text" id="contentText">Loading bio...</div>
    </section>

    <script>
      // ðŸ”¹ Load bio.md
      document.addEventListener("DOMContentLoaded", () => {
        fetch("bio.md")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("contentText").innerHTML = marked.parse(data);
            hljs.highlightAll();
            
            // Initialize tooltips with local tooltip file after bio content loads
            setTimeout(() => {
              if (window.tooltipManager) {
                // For bio page, load tooltips directly from res/tooltips.json
                window.tooltipManager.loadTooltipData('').then(() => {
                  // Override the blog folder detection for bio page
                  fetch("res/tooltips.json")
                    .then(response => response.json())
                    .then(data => {
                      // Store tooltip data directly without blog folder prefix
                      Object.entries(data).forEach(([id, tooltipData]) => {
                        // For bio page, media paths are relative to res/ folder
                        if (tooltipData.media && !tooltipData.media.startsWith('http')) {
                          tooltipData.media = `res/${tooltipData.media}`;
                        }
                        window.tooltipManager.tooltipData.set(id, tooltipData);
                      });
                      window.tooltipManager.initializeTooltips();
                    })
                    .catch(error => console.warn('Error loading bio tooltips:', error));
                });
              }
            }, 100);
          })
          .catch((error) => {
            console.error("Error loading bio:", error);
            document.getElementById("contentText").innerHTML =
              "Failed to load bio.";
          });
      });

      // ðŸ”¹ Load banner.html and initialize dropdown
      document.addEventListener("DOMContentLoaded", () => {
        fetch("../banner.html")
          .then((response) => response.text())
          .then((data) => {
            const banner = document.getElementById("banner-placeholder");
            banner.innerHTML = data;
            // Always try to initialize dropdowns after banner loads
            if (typeof initDropdownToggle === "function") {
              initDropdownToggle();
            }
          })
          .catch((error) => console.error("Error loading banner:", error));
      });

      // Reinitialize dropdown toggle on resize
      let resizeTimer;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
          if (typeof initDropdownToggle === "function") {
            initDropdownToggle();
          }
        }, 100);
      });

      // Ensure dropdowns are initialized on load
      window.addEventListener("load", () => {
        if (typeof initDropdownToggle === "function") {
          initDropdownToggle();
        }
      });
    </script>
    <script src="../script.js"></script>
  </body>
</html>